version: "3.3"
services:
  mealie:
    image: hkotel/mealie:latest        # Specifies the Mealie image
    container_name: mealie
    restart: unless-stopped
    environment:
      - PUID=${PUID}                  # User ID for file permissions
      - PGID=${PGID}                  # Group ID for file permissions
      - TZ=${TZ}                      # Time zone (e.g., "America/New_York")
      - DATABASE_TYPE=postgres        # Use "postgres" for PostgreSQL
      - SECRET_KEY=${MEALIE_SECRET_KEY}  # Secret key for encryption
      - POSTGRES_USER=${PG_USER}
      - POSTGRES_PASSWORD=${PG_PASSWORD}
      - POSTGRES_HOST=postgres
      - POSTGRES_PORT=5432
      - POSTGRES_DB=mealie
    volumes:
      - mealie-data:/app/data         # Persistent volume for Mealie's data
    ports:
      - "9925:80"                     # Map port 9925 to Mealie's default port
    networks:
      - media-network                 # Attach to custom network

  postgres:
    image: postgres:13                # Specifies the PostgreSQL image
    container_name: mealie-postgres
    restart: unless-stopped
    environment:
      - POSTGRES_USER=${PG_USER}
      - POSTGRES_PASSWORD=${PG_PASSWORD}
      - POSTGRES_DB=mealie
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - media-network                 # Attach to the same custom network as Mealie

# Volumes for persistent data storage
volumes:
  mealie-data:
  postgres-data:

# Custom network for container communication
networks:
  media-network:
    driver: bridge
